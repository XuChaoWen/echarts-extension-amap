/*!
 * echarts-extension-amap 
 * @version 1.9.0
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2019-2021 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("echarts/lib/echarts")):"function"==typeof define&&define.amd?define(["exports","echarts/lib/echarts"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).echarts=e.echarts||{},e.echarts.amap={}),e.echarts)}(this,(function(e,t){"use strict";function n(e,n){return n=n||[0,0],t.util.map([0,1],(function(t){var o=n[t],a=e[t]/2,i=[],r=[];return i[t]=o-a,r[t]=o+a,i[1-t]=r[1-t]=n[1-t],Math.abs(this.dataToPoint(i)[t]-this.dataToPoint(r)[t])}),this)}var o=["echartsLayerZIndex","echartsLayerInteractive","renderOnMoving","largeMode","layers"];function a(e,t){this._amap=e,this._api=t,this._mapOffset=[0,0]}var i=a.prototype;i.setZoom=function(e){this._zoom=e},i.setCenter=function(e){var t=new AMap.LngLat(e[0],e[1]);this._center=this._amap.lngLatToContainer(t)},i.setMapOffset=function(e){this._mapOffset=e},i.setAMap=function(e){this._amap=e},i.getAMap=function(){return this._amap},i.dataToPoint=function(e){var t=new AMap.LngLat(e[0],e[1]),n=this._amap.lngLatToContainer(t),o=this._mapOffset;return[n.x-o[0],n.y-o[1]]},i.pointToData=function(e){var t=this._mapOffset,n=this._amap.containerToLngLat(new AMap.Pixel(e[0]+t[0],e[1]+t[1]));return[n.lng,n.lat]},i.getViewRect=function(){var e=this._api;return new t.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},i.getRoamTransform=function(){return t.matrix.create()},i.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:"amap",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:t.util.bind(this.dataToPoint,this),size:t.util.bind(n,this)}}},a.create=function(e,n){var i,r=n.getDom();e.eachComponent("amap",(function(e){var s=n.getZr().painter,f=s.getViewportRoot();if("undefined"==typeof AMap)throw new Error("AMap api is not loaded");if(i)throw new Error("Only one amap component can exist");var c=e.getAMap(),p=e.get("echartsLayerInteractive");if(!c){var u=r.querySelector(".ec-extension-amap");u&&(f.style.left="0px",f.style.top="0px",r.removeChild(u)),(u=document.createElement("div")).className="ec-extension-amap",u.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",r.appendChild(u);var m=t.util.clone(e.get());"echartsLayerZIndex"in m&&console.warn("[ECharts][Extension][AMap] DEPRECATED: the option `echartsLayerZIndex` has been removed since v1.9.0, use `echartsLayerInteractive` instead."),t.util.each(o,(function(e){delete m[e]})),c=new AMap.Map(u,m),e.setAMap(c),u.querySelector(".amap-maps").appendChild(f),e.setEChartsLayer(f),s.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}e.setEChartsLayerInteractive(p);var d=e.get("center"),l=e.get("zoom");if(d&&l){var h=c.getCenter(),v=c.getZoom();e.centerOrZoomChanged([h.lng,h.lat],v)&&c.setZoomAndCenter(l,new AMap.LngLat(d[0],d[1]))}var y=e.__mapStyle,g=e.get("mapStyle");if(y!==g&&(c.setMapStyle(g),e.__mapStyle=g),c.setLang){var _=e.__mapLang,M=e.get("lang");_!==M&&(c.setLang(M),e.__mapLang=M)}(i=new a(c,n)).setMapOffset(e.__mapOffset||[0,0]),i.setZoom(l),i.setCenter(d),e.coordinateSystem=i})),e.eachSeries((function(e){"amap"===e.get("coordinateSystem")&&(e.coordinateSystem=i)}))},i.dimensions=a.dimensions=["lng","lat"];var r=t.version.split(".")[0]>4;var s={type:"amap",setAMap:function(e){this.__amap=e},getAMap:function(){return this.__amap},setEChartsLayer:function(e){this.__echartsLayer=e},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisiblity:function(e){this.__echartsLayer.style.display=e?"block":"none"},setEChartsLayerInteractive:function(e){this.__echartsLayer.style.pointerEvents=e?"auto":"none"},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n,o,a=this.option;return o=a.center,!((n=e)&&o&&n[0]===o[0]&&n[1]===o[1]&&t===a.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,isHotspot:!1,resizeEnable:!0,echartsLayerInteractive:!0,renderOnMoving:!0,largeMode:!1}},f=r?t.ComponentModel.extend(s):s,c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p=/^\s+|\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,d=/^0o[0-7]+$/i,l=parseInt,h="object"==typeof self&&self&&self.Object===Object&&self,v="object"==typeof c&&c&&c.Object===Object&&c||h||Function("return this")(),y=Object.prototype.toString,g=Math.max,_=Math.min,M=function(){return v.Date.now()};function C(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==y.call(e)}(e))return NaN;if(C(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=C(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(p,"");var n=m.test(e);return n||d.test(e)?l(e.slice(2),n?2:8):u.test(e)?NaN:+e}var L=function(e,t,n){var o,a,i,r,s,f,c=0,p=!1,u=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function d(t){var n=o,i=a;return o=a=void 0,c=t,r=e.apply(i,n)}function l(e){return c=e,s=setTimeout(v,t),p?d(e):r}function h(e){var n=e-f;return void 0===f||n>=t||n<0||u&&e-c>=i}function v(){var e=M();if(h(e))return y(e);s=setTimeout(v,function(e){var n=t-(e-f);return u?_(n,i-(e-c)):n}(e))}function y(e){return s=void 0,m&&o?d(e):(o=a=void 0,r)}function L(){var e=M(),n=h(e);if(o=arguments,a=this,f=e,n){if(void 0===s)return l(f);if(u)return s=setTimeout(v,t),d(f)}return void 0===s&&(s=setTimeout(v,t)),r}return t=b(t)||0,C(n)&&(p=!!n.leading,i=(u="maxWait"in n)?g(b(n.maxWait)||0,t):i,m="trailing"in n?!!n.trailing:m),L.cancel=function(){void 0!==s&&clearTimeout(s),c=0,o=f=a=s=void 0},L.flush=function(){return void 0===s?r:y(M())},L},w={type:"amap",init:function(){this._isFirstRender=!0},render:function(e,t,n){var o=!0,a=e.getAMap(),i=n.getZr().painter.getViewportRoot(),r=a.getContainer(),s=e.coordinateSystem,f=e.get("renderOnMoving"),c=e.get("resizeEnable"),p=e.get("largeMode"),u=AMap.version>=2,m="3D"===a.getViewMode_(),d=function(){if(!o){var t=r.style,a=[-parseInt(t.left,10)||0,-parseInt(t.top,10)||0],f=i.style,c=a[0]+"px",p=a[1]+"px";f.left!==c&&(f.left=c),f.top!==p&&(f.top=p),s.setMapOffset(e.__mapOffset=a),n.dispatchAction({type:"amapRoam",animation:{duration:0}})}};if(a.off("mapmove",this._moveHandler),a.off("moveend",this._moveHandler),a.off("viewchange",this._moveHandler),a.off("camerachange",this._moveHandler),a.off("zoom",this._moveHandler),this._resizeHandler&&a.off("resize",this._resizeHandler),this._moveStartHandler&&a.off("movestart",this._moveStartHandler),this._moveEndHandler&&(a.off("moveend",this._moveEndHandler),a.off("zoomend",this._moveEndHandler)),a.on(f?u?"viewchange":m?"camerachange":"mapmove":"moveend",!u&&p?d=L(d,20):d),this._moveHandler=d,!f||u&&m||a.on("zoom",d),!f){a.on("movestart",this._moveStartHandler=function(t){setTimeout((function(){e.setEChartsLayerVisiblity(!1)}),0)});var l=this._moveEndHandler=function(t){(!t||"moveend"!==t.type)&&d(),setTimeout((function(){e.setEChartsLayerVisiblity(!0)}),u||!p?0:20)};if(a.on("moveend",l),a.on("zoomend",l),this._isFirstRender&&m){var h=a.setPitch,v=a.setRotation;a.setPitch=function(){h.apply(this,arguments),l()},a.setRotation=function(){v.apply(this,arguments),l()}}}if(c){var y=function(){echarts.getInstanceByDom(n.getDom()).resize()};!u&&p&&(y=L(y,20)),a.on("resize",this._resizeHandler=y)}this._isFirstRender=o=!1},dispose:function(e){var t=e.getComponent("amap");t&&(t.getAMap().destroy(),t.setAMap(null),t.setEChartsLayer(null),t.coordinateSystem&&(t.coordinateSystem.setAMap(null),t.coordinateSystem=null),delete this._moveHandler,delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler)}},x=r?t.ComponentView.extend(w):w;function E(e){r?e.registerComponentModel(f):e.extendComponentModel(f),r?e.registerComponentView(x):e.extendComponentView(x),e.registerCoordinateSystem("amap",a),e.registerAction({type:"amapRoam",event:"amapRoam",update:"updateLayout"},(function(e,t){t.eachComponent("amap",(function(e){var t=e.getAMap(),n=t.getCenter();e.setCenterAndZoom([n.lng,n.lat],t.getZoom())}))}))}r?t.use(E):E(t),e.name="echarts-extension-amap",e.version="1.9.0",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=echarts-extension-amap.min.js.map
