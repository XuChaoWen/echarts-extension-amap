/*!
 * echarts-extension-amap 
 * @version 1.10.0
 * @author plainheart
 * 
 * MIT License
 * 
 * Copyright (c) 2019-2021 Zhongxiang.Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("echarts/lib/echarts")):"function"==typeof define&&define.amd?define(["exports","echarts"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).echarts=e.echarts||{},e.echarts.amap={}),e.echarts)}(this,(function(e,t){"use strict";var n=t.version.split(".")[0]>4,a=AMap.version>=2;var o={};function r(e,t,n){var a="[ECharts][Extension][AMap]".concat(e?" "+e+":":""," ").concat(t);n&&o[a]||console.warn(a),n&&(o[a]=!0)}function i(e,n){return n=n||[0,0],t.util.map([0,1],(function(t){var a=n[t],o=e[t]/2,r=[],i=[];return r[t]=a-o,i[t]=a+o,r[1-t]=i[1-t]=n[1-t],Math.abs(this.dataToPoint(r)[t]-this.dataToPoint(i)[t])}),this)}var s=["echartsLayerZIndex","echartsLayerInteractive","renderOnMoving","largeMode","returnMapCameraState","layers"];function p(e,t){this._amap=e,this._api=t,this._mapOffset=[0,0]}var c=p.prototype;c.setZoom=function(e){this._zoom=e},c.setCenter=function(e){var t=new AMap.LngLat(e[0],e[1]);this._center=this._amap.lngLatToContainer(t)},c.setMapOffset=function(e){this._mapOffset=e},c.setAMap=function(e){this._amap=e},c.getAMap=function(){return this._amap},c.dataToPoint=function(e){var t=new AMap.LngLat(e[0],e[1]),n=this._amap.lngLatToContainer(t),a=this._mapOffset;return[n.x-a[0],n.y-a[1]]},c.pointToData=function(e){var t=this._mapOffset,n=this._amap.containerToLngLat(new AMap.Pixel(e[0]+t[0],e[1]+t[1]));return[n.lng,n.lat]},c.getViewRect=function(){var e=this._api;return new t.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},c.getRoamTransform=function(){return t.matrix.create()},c.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:"amap",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:t.util.bind(this.dataToPoint,this),size:t.util.bind(i,this)}}},p.create=function(e,n){var a;e.eachComponent("amap",(function(e){if("undefined"==typeof AMap)throw new Error("AMap api is not loaded");if(a)throw new Error("Only one amap component can exist");var o=e.getAMap(),i=e.get("echartsLayerInteractive");if(!o){var c=n.getDom(),m=n.getZr().painter,h=m.getViewportRoot();h.className="amap-ec-layer",h.style.visibility="hidden";var l=c.querySelector(".ec-extension-amap");l&&(h.style.left="0px",h.style.top="0px",c.removeChild(l)),(l=document.createElement("div")).className="ec-extension-amap",l.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",c.appendChild(l);var d=t.util.clone(e.get());"echartsLayerZIndex"in d&&r("DEPRECATED","the option `echartsLayerZIndex` has been removed since v1.9.0, use `echartsLayerInteractive` instead."),t.util.each(s,(function(e){delete d[e]})),(o=new AMap.Map(l,d)).on("complete",(function(){l.querySelector(".amap-maps").appendChild(h),h.style.visibility=""})),e.setAMap(o),e.setEChartsLayer(h),m.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}e.__echartsLayerInteractive!==i&&(e.setEChartsLayerInteractive(i),e.__echartsLayerInteractive=i);var f=e.get("center"),u=e.get("zoom");if(f&&u){var g=o.getCenter(),v=o.getZoom();e.centerOrZoomChanged([g.lng,g.lat],v)&&o.setZoomAndCenter(u,new AMap.LngLat(f[0],f[1]))}var y=e.__mapStyle,_=e.get("mapStyle");if(y!==_&&o.setMapStyle(e.__mapStyle=_),o.setLang){var C=e.__mapLang,M=e.get("lang");C!==M&&o.setLang(e.__mapLang=M)}else r("CAVEAT","The current map doesn't support `setLang` API!",!0);(a=new p(o,n)).setMapOffset(e.__mapOffset||[0,0]),a.setZoom(u),a.setCenter(f),e.coordinateSystem=a})),e.eachSeries((function(e){"amap"===e.get("coordinateSystem")&&(e.coordinateSystem=a)}))},c.dimensions=p.dimensions=["lng","lat"];var m={type:"amap",setAMap:function(e){this.__amap=e},getAMap:function(){return this.__amap},setEChartsLayer:function(e){this.__echartsLayer=e},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisiblity:function(e){this.__echartsLayer.style.display=e?"block":"none"},setEChartsLayerInteractive:function(e){this.option.echartsLayerInteractive=!!e,this.__echartsLayer.style.pointerEvents=e?"auto":"none"},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n,a,o=this.option;return a=o.center,!((n=e)&&a&&n[0]===a[0]&&n[1]===a[1]&&t===o.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,isHotspot:!1,resizeEnable:!0,echartsLayerInteractive:!0,renderOnMoving:!0,largeMode:!1,returnMapCameraState:!1}},h=n?t.ComponentModel.extend(m):m,l={type:"amap",init:function(){this._isFirstRender=!0},render:function(e,n,o){var r=!0,i=e.getAMap(),s=o.getZr().painter.getViewportRoot(),p=i.getContainer(),c=e.coordinateSystem,m=e.get("renderOnMoving"),h=e.get("resizeEnable"),l=e.get("largeMode"),d=e.get("returnMapCameraState"),f=i.getViewMode_(),u="3D"===f,g=function(t){if(!r){var n=p.style,a=[-parseInt(n.left,10)||0,-parseInt(n.top,10)||0],m=s.style,h=a[0]+"px",l=a[1]+"px";m.left!==h&&(m.left=h),m.top!==l&&(m.top=l),c.setMapOffset(e.__mapOffset=a);var u={type:"amapRoam",animation:{duration:0}};if(d){var g=(t=t||{}).center;g||(g=[(g=i.getCenter()).lng,g.lat]),u.camera={viewMode:f,center:g,zoom:t.zoom||i.getZoom(),rotation:null==t.rotation?i.getRotation():t.rotation,pitch:null==t.pitch?i.getPitch():t.pitch,scale:i.getScale(),bounds:i.getBounds()}}o.dispatchAction(u)}};if(i.off("mapmove",this._moveHandler),i.off("moveend",this._moveHandler),i.off("viewchange",this._moveHandler),i.off("camerachange",this._moveHandler),i.off("zoom",this._moveHandler),this._resizeHandler&&i.off("resize",this._resizeHandler),this._moveStartHandler&&i.off("movestart",this._moveStartHandler),this._moveEndHandler&&(i.off("moveend",this._moveEndHandler),i.off("zoomend",this._moveEndHandler)),i.on(m?a?"viewchange":u?"camerachange":"mapmove":"moveend",!a&&l?g=t.throttle(g,20,!0):g),this._moveHandler=g,!m||a&&u||i.on("zoom",g),!m){i.on("movestart",this._moveStartHandler=function(t){setTimeout((function(){e.setEChartsLayerVisiblity(!1)}),0)});var v=this._moveEndHandler=function(t){(!t||"moveend"!==t.type)&&g(t),setTimeout((function(){e.setEChartsLayerVisiblity(!0)}),a||!l?0:20)};if(i.on("moveend",v),i.on("zoomend",v),this._isFirstRender&&u){var y=i.setPitch,_=i.setRotation;i.setPitch=function(){y.apply(this,arguments),v()},i.setRotation=function(){_.apply(this,arguments),v()}}}if(h){var C=function(){t.getInstanceByDom(o.getDom()).resize()};!a&&l&&(C=t.throttle(C,20,!0)),i.on("resize",this._resizeHandler=C)}this._isFirstRender=r=!1},dispose:function(e){o={};var t=e.getComponent("amap");t&&(t.getAMap().destroy(),t.setAMap(null),t.setEChartsLayer(null),t.coordinateSystem&&(t.coordinateSystem.setAMap(null),t.coordinateSystem=null),delete this._moveHandler,delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler)}},d=n?t.ComponentView.extend(l):l;function f(e){n?e.registerComponentModel(h):e.extendComponentModel(h),n?e.registerComponentView(d):e.extendComponentView(d),e.registerCoordinateSystem("amap",p),e.registerAction({type:"amapRoam",event:"amapRoam",update:"updateLayout"},(function(e,t){t.eachComponent("amap",(function(e){var t=e.getAMap(),n=t.getCenter();e.setCenterAndZoom([n.lng,n.lat],t.getZoom())}))}))}n?t.use(f):f(t),e.name="echarts-extension-amap",e.version="1.10.0",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=echarts-extension-amap.min.js.map
